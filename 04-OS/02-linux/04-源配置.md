# 1. yum安装

## 1.1 yum安装

### 1.1.1 删除yum

```bash
rpm -qa|grep yum|xargs rpm -e --nodeps
```

### 1.2.1 下载安装yum

* 下载

  注意使用的版本, 当前为6.

  ```bash
  wget http://mirrors.aliyun.com/centos/6/os/x86_64/Packages/rpm-4.8.0-59.el6.x86_64.rpm &&
  wget http://mirrors.aliyun.com/centos/6/os/x86_64/Packages/yum-metadata-parser-1.1.2-16.el6.x86_64.rpm &&
  wget http://mirrors.aliyun.com/centos/6/os/x86_64/Packages/python-urlgrabber-3.9.1-11.el6.noarch.rpm &&
  wget http://mirrors.aliyun.com/centos/6/os/x86_64/Packages/yum-3.2.29-81.el6.centos.noarch.rpm &&
  wget http://mirrors.aliyun.com/centos/6/os/x86_64/Packages/yum-plugin-fastestmirror-1.1.30-41.el6.noarch.rpm
  ```

* 安装

  ```bash
  rpm -ivh *.rpm --force --nodeps  # 强制批量安装
  ```

## 1.2 Rehat激活

未激活的Redhat, 需要重新安装yum, 否则不能安装软件. 也可以直接激活, 但是不建议, 官方的软件包太少了.

激活后换源是不支持的.

### 1.2.1 开发者账号注册

访问下列网站完成注册

```bash
https://developers.redhat.com/auth/realms/rhd/protocol/openid-connect/registrations?client_id=web&redirect_uri=http%3A%2F%2Fdevelopers.redhat.com%2Fblog%2F2014%2F06%2F26%2Frhel-7-is-for-developers%2F&state=8bc8e6d2-7dea-42c2-96da-c5e2e5755fca&nonce=eab2e0c7-b41d-44a9-99ad-0c2dbd5170a9&response_mode=fragment&response_type=code
```

### 1.2.2 账号登录激活

```bash
[root@localhost gcc-4.8.5]# subscription-manager register --username=565956231@qq.com --password=wdlRE4911? --auto-attach
The system has been registered with ID: 1b6c59d6-fb26-454d-ab37-fe14837f261c 
Installed Product Current Status:
Product Name: Red Hat Enterprise Linux Server
Status: Subscribed
```

# 2. yum换源

```bash
yum install -y python # 安装程序
yum -y update python  # 更新程序, 会改变系统/软件设置, 更新系统, 内核.
yum -y upgrade python # 更新程序, 不改变上述设置
yum -y update         # 整个系统更新, 升级
yum -y info python    # 查看程序详细信息
yum -y remove python  # 拆卸程序
yum search python     # 搜索相关程序包
yum grouplist  # 查看有哪些软件组包
yum groupinstall groupname  # 直接安装软件组包, 例如`yum groupinstall 'Development tools'`
```

* install: 安装包
* update: 升级, 如果不加包名, 这进行系统升级
* info: 查看安装包的作用
* provides: 通过安装后的软件, 查找安装包
* remove

## 2.1 在线源

源文件位置: /etc/yum.repos.d/*.repo

1. 删除源文件

   ```bash
   cd /etc/yum.repos.d
   rm -rf *.repo
   ```

2. 下载需要使用的源

   ```bash
   wget http://mirrors.aliyun.com/repo/Centos-6.repo  # 阿里云
   wget http://mirrors.163.com/.help/CentOS6-Base-163.repo # 网易
   ```

3. 修改变量

   下载的文件中, 存在两个变量

   * $releaserver: 系统版本号, `cat /etc/centos-release`
   * $basearch: 表示系统位数, `uname -r`

   如果发现系统版本和远程服务器版本不一致, 则手动进行修改.(一般服务器保存的是最新版本的数据)

   ```bash
   vim Centos-6.repo  #进入vim进行批量替换
   :%s/$releasever/6/g
   ```

4. 清理缓存, 即可使用

   ```bash
   yum clean all
   yum makecache
   ```

   

## 2.2 挂载ISO盘

### 2.2.1 开机自动加载

```bash
vim /etc/fstab
```

追加内容

```bash
/dev/sr0		/mnt		iso9660     defaults   0   0  # 或者
/dev/cdrom              /mnt                    iso9660 defaults        0 0
```

* /dev/cdrom: 需要挂载的盘符
* /mnt:  挂载的位置
* iso9660: iso盘格式
* defaults: 控制权限等问题
* 0  0: 是否进行开启检测  , 0表示不检测

### 2.2.2 挂载ISO盘

```bash
mount -a  # 挂载
umount /mnt/  # 卸载挂载
```

查看挂载内容

```bash
ls /mnt/
```

![image-20200710231223206](image/04-yum%E6%BA%90%E9%85%8D%E7%BD%AE/image-20200710231223206.png)

### 2.2.3 指定yum使用ISO

1. 清空源

   ```bash
   cd /etc/yum.repos.d/
   rm -rf *
   ```

2. 配置源

   ```bash
   vim test.repo
   ```

   增加如下内容

   ```bash
   [Redhat]
   name=Redhat-Server
   baseurl=file:///mnt
   enabled=1
   gpgcheck=0
   ```

   * name: 服务名称
   * baseurl: 指定使用源位置, 支持(file:///, http://, ftp://)等
   * enabled: 是否启用
   * gpgcheck: 是否使用公钥检查

3. 清空缓存, 并使用

   ```bash
   yum clean all
   yum install python-pip
   ```

   

# 3. rpm

rpm: Redhat Packages Manger(RPM软件包管理), 虽然打上Redhat标签, 但是为开放式的, OpenLinux, SUSE, Turbo Linux等linux都采用此软件包管理

```bash
rpm [参数] *.rpm
```

* -i: install, 安装rpm包
* -U: 升级包
* -v: 显示附加消息, 提供更详细消息
* -V: 校验已安装的软件包的hash值
* -h: 安装时输出`###`等互动标记
* --nodeps: 安装, 或者删除时忽略依赖
* --force: 强制安装
* -e: 删除安装包

* -q: query查询rpm安装包
  * a: 查询全部安装包
  * f: 通过文件名查询rpm
  * i: 显示已经安装的rpm软件包的详细信息
  * l: list, 查询软件包文件安装的位置
  * p: 查询未安装软件包的相关信息
  * -R: 查询软件包的依赖性



## 3.1 rpm常用组合

### 3.1.1 安装

```bash
rpm -ivh /mnt/Packages/python-2.6.6-51.el6.x86_64.rpm  # 本地安装
rpm -ivh http://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm  # 安装epel拓展源

rpm -ivh *.rpm --force --nodeps  # 忽略依赖关系, 并强制安装
```



### 3.1.2 查询

```bash
[root@localhost ~]# rpm -qf `which find`  # 通过路径查询安装的rpm包
findutils-4.4.2-6.el6.x86_64

[root@localhost ~]# rpm -qpl /mnt/Packages/python-2.6.6-51.el6.x86_64.rpm # 查询软件包安装后将会生成那些文件
warning: /mnt/Packages/python-2.6.6-51.el6.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID fd431d51: NOKEY
/usr/bin/pydoc
/usr/bin/python
/usr/bin/python2
/usr/bin/python2.6
/usr/share/doc/python-2.6.6
/usr/share/doc/python-2.6.6/LICENSE
/usr/share/doc/python-2.6.6/README
/usr/share/man/man1/python.1.gz
```

### 3.1.3 修改检测

检测rpm包安装后, 是否文件被修改.

```bash
[root@localhost ~]# rpm -V findutils-4.4.2-6.el6.x86_64  # 指定rpm检测
[root@localhost ~]#

[root@localhost ~]# rpm -Vf `which find`  # 指定路径检测
[root@localhost ~]#

[root@localhost ~]# rpm -qaV  # 自动扫描全部rpm并检测
prelink: /usr/bin/rhythmbox: at least one of file's dependencies has changed since prelinking
S.?......    /usr/bin/rhythmbox
```

* 5:  md5值, 校验失败
* S: 文件长度, 校验失败
* L: 链接路径, 校验失败
* T: 文件修改日期, 校验失败
* D: 设备信息, 校验失败
* U: 用户创建者, 校验失败
* G: 用户组, 校验失败
* ?: 不可读文件
* c: 配置文件, 校验失败
* d: 普通文件
* g: 增加了文件
* l: 授权文件
* r: 描述文件



### 3.1.4 删除

删除安装包, 尽量不要删除依赖关系.

```bash
rpm -e --nodeps python  # 删除Python, 不删除相关依赖
```

删除后, 检查

```bash
rpm -qa python
```

### 3.1.5 升级

```bash
rpm -Uvh xxx.rpm
```

一般情况下, 直接升级会升级失败, 因为有大量的依赖包也许要升级.

#### 3.1.5.1 依赖关系解决

```bash
[root@localhost ~]# rpm -ivh /mnt/Packages/mariadb-server-5.5.65-1.el7.x86_64.rpm 
error: Failed dependencies:
	mariadb(x86-64) = 1:5.5.65-1.el7 is needed by mariadb-server-1:5.5.65-1.el7.x86_64
	perl(DBI) is needed by mariadb-server-1:5.5.65-1.el7.x86_64
	perl-DBD-MySQL is needed by mariadb-server-1:5.5.65-1.el7.x86_64
	perl-DBI is needed by mariadb-server-1:5.5.65-1.el7.x86_64
[root@localhost ~]# rpm -ivh /mnt/Packages/mariadb-5.5.65-1.el7.x86_64.rpm 
```

依赖安装

```bash
rpm -ivh /mnt/Packages/mariadb-5.5.65-1.el7.x86_64.rpm
rpm -ivh /mnt/Packages/perl-DBD-MySQL-4.023-6.el7.x86_64.rpm
rpm -ivh /mnt/Packages/mariadb-server-5.5.65-1.el7.x86_64.rpm 
```



# 4. 源码编译安装

```bash
./configure
make -j 4
make install
```

## 4.1 常见错误解决

* yum search package
* 直接使用此网站查询 : http://www.rpmseek.com/index.html